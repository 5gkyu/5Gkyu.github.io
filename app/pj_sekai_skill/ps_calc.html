<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒ—ãƒ­ã‚»ã‚« å®ŸåŠ¹å€¤ãƒ»å†…éƒ¨å€¤ è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>

  <!-- Meta: èª¬æ˜ãƒ»robotsãƒ»canonical -->
  <meta name="description" content="ãƒ—ãƒ­ã‚»ã‚«ç”¨ å®ŸåŠ¹å€¤ãƒ»å†…éƒ¨å€¤ è¨ˆç®—å™¨ â€” 5ã¤ã®æ•°å€¤ã‚’é€£çµã—ã¦å…¥åŠ›ã™ã‚‹ã¨åˆ†å‰²ãƒ»æ¤œè¨¼ã—ã€å®ŸåŠ¹å€¤ã¨å†…éƒ¨å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã—ã¾ã™ã€‚3æ¡å„ªå…ˆã®åˆ†å‰²ãƒ«ãƒ¼ãƒ«ã‚’æ¡ç”¨ã€‚">
  <meta name="robots" content="index,follow">
  <link rel="canonical" href="https://5gkyu.github.io/app/pj_sekai_skill/ps_calc.html">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ãƒ—ãƒ­ã‚»ã‚« å®ŸåŠ¹å€¤ãƒ»å†…éƒ¨å€¤ è¨ˆç®—å™¨">
  <meta property="og:description" content="5ã¤ã®æ•°å€¤ã‚’é€£çµå…¥åŠ›ã—ã¦å®ŸåŠ¹å€¤ï¼ˆLeader + sum(sub)/5ï¼‰ã¨å†…éƒ¨å€¤ï¼ˆåˆè¨ˆï¼‰ã‚’å³æ™‚è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚">
  <meta property="og:url" content="https://5gkyu.github.io/app/pj_sekai_skill/ps_calc.html">
  <meta name="twitter:card" content="summary_large_image">

  <!-- JSON-LD: WebApplication / SoftwareApplication ã®ä¾‹ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "ãƒ—ãƒ­ã‚»ã‚« å®ŸåŠ¹å€¤ãƒ»å†…éƒ¨å€¤è¨ˆç®—ãƒ„ãƒ¼ãƒ«",
    "url": "https://5gkyu.github.io/app/pj_sekai_skill/index.html",
    "description": "5ã¤ã®æ•°å€¤ã‚’é€£çµã—ã¦å…¥åŠ›ã™ã‚‹ã¨åˆ†å‰²ãƒ»æ¤œè¨¼ã—ã€å®ŸåŠ¹å€¤ã¨å†…éƒ¨å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã—ã¾ã™ã€‚",
    "applicationCategory": "Utilities",
    "operatingSystem": "Web",
    "author": {
      "@type": "Person",
      "name": "5gkyu"
    }
  }
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2123379565748161"
     crossorigin="anonymous"></script>
  <style>
    html, body { height: 100%; min-height: 100vh; margin: 0; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", Meiryo, Helvetica, Arial;
      padding: 8px;
      color: #111;
      background-color: #f7f8fb;
      position: relative;
      overflow-x: hidden;
    }
    /* èƒŒæ™¯ç”»åƒã‚’å›ºå®šãƒ¬ã‚¤ãƒ¤ãƒ¼ã§æ•·ãã€å¸¸ã«ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå…¨ä½“ã‚’åŸ‹ã‚ã‚‹ (ãƒ¢ãƒã‚¤ãƒ«ã®ä½™ç™½å¯¾ç­–) */
    body::before{
      content: "";
      position: fixed;
      inset: 0;
      background-image: url('https://5gkyu.github.io/image/backimage.png');
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      z-index: -1;
    }
    .card{background:#fff;border-radius:6px;padding:12px;max-width:520px;margin:6px auto;box-shadow:0 1px 4px rgba(20,20,40,.04);width:auto;box-sizing:border-box}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type="text"]{width:100%;font-size:1rem;padding:8px;border:1px solid #d8dbe6;border-radius:6px}
    .big-input{width:100%;font-size:1.4rem;padding:10px 60px 10px 12px;height:52px;box-sizing:border-box;border-radius:8px;border:1px solid #cfd8ff}
    .reset-button{position:absolute;top:50%;right:6px;transform:translateY(-50%);background:#fff5f5;border:1px solid #ffd6d6;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;color:#a00010;font-size:0.9rem;line-height:1}
    .reset-button:hover{background:#fff0f0}
    .row{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .box{flex:1;padding:8px;background:#E6FBFA;border-radius:6px;border:1px solid #dff6f4}
    .muted{color:#666;font-size:.9rem}
    .error{color:#b00020;font-weight:700}
    .parts{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:8px;align-items:center}
    .parts-labels{grid-column:1/-1;display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .parts-values{grid-column:1/-1;display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .label-cell{background:transparent;text-align:center;padding:4px 6px;border-radius:6px;color:#234;font-weight:700;font-size:.95rem}
    .parts-labels .label-cell:first-child{background:#e6fbff;color:#00a3c4}
    .value-cell{background:#f6fbff;text-align:center;padding:8px 6px;border-radius:6px;border:1px solid #e6f0ff;font-weight:800}
    .example{font-size:.95rem;color:#444;margin-top:8px}
    .result-value{display:inline-block;font-size:1.4rem;font-weight:800;margin-left:8px}
    .result-effective{color:#0b66ff}
    .result-internal{color:#0b9d3b}
    .result-box{background:#E6FBFA;padding:10px;border-radius:8px;border:1px solid #dff6f4}
    .label-small{font-size:0.85rem;color:#334}
    .top-actions{display:flex;justify-content:flex-end;margin-bottom:6px}
    .x-button{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#000;color:#fff;text-decoration:none;font-weight:700;font-size:0.95rem}
    .x-button:hover{background:#111}
    .x-glyph{font-size:18px;line-height:1;display:inline-block;font-weight:800}
    /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã‚’è–„ãè¡¨ç¤º */
    input::placeholder { color: #9aa !important; opacity: 1; }
    input::-webkit-input-placeholder { color: #9aa; }
    input::-moz-placeholder { color: #9aa; opacity:1; }
    input:-ms-input-placeholder { color: #9aa; }
    input:-moz-placeholder { color: #9aa; }
    /* ãƒ¡ã‚¤ãƒ³å…¥åŠ›å‘¨ã‚Šã®å¼·èª¿ */
    .input-area{background:#E6FBFA;border-radius:10px;padding:6px;}
    /* è¨ˆç®—é€”ä¸­å¼è¡¨ç¤º */
    .calc-steps{margin-top:10px;padding:8px;border-radius:6px;background:rgba(255,255,255,0.6);font-size:0.95rem;color:#123;border:1px dashed rgba(0,0,0,0.03)}
    .calc-steps .line{margin-top:6px}
    .calc-steps .expr{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace; background:transparent}
  </style>
</head>
<body>
  <div class="card">
    <div class="top-actions">
      <a class="x-button" href="https://x.com/5gkyu" target="_blank" rel="noopener noreferrer" aria-label="X ã® @5gkyu ã«ç§»å‹•">
        <span class="x-glyph" aria-hidden="true">ğ•</span>
        <span>@5gkyu</span>
      </a>
    </div>
    <h1>ãƒ—ãƒ­ã‚»ã‚« â€” å®ŸåŠ¹å€¤ å†…éƒ¨å€¤è¨ˆç®—</h1>
    <p class="muted">ã‚¹ã‚³ã‚¢UP%ã‚’é€£çµã•ã›ã¦å…¥åŠ›ã€‚</p>
        <p class="muted">ä¾‹: ãƒªãƒ¼ãƒ€ãƒ¼160%,ãã®ä»–150%,140%,130%,130%ã®å ´åˆ<br>  â†’ 160150140130130ã‚’å…¥åŠ›ã€‚</p>


    <div class="input-area" style="position:relative;">
      <input id="input" class="big-input" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="15" placeholder="ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„" aria-describedby="help">
      <button id="reset" type="button" class="reset-button" aria-label="ãƒªã‚»ãƒƒãƒˆå…¥åŠ›">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="row">
      <div class="box result-box">
        <div><strong>è¨ˆç®—çµæœ</strong></div>
        <div style="margin-top:12px"><div class="label-small">å®ŸåŠ¹å€¤</div><div id="effective" class="result-value result-effective">â€”</div></div>
        <div style="margin-top:12px"><div class="label-small">å†…éƒ¨å€¤</div><div id="internal" class="result-value result-internal">â€”</div></div>
        <div id="error" class="error" style="margin-top:12px" aria-live="polite"></div>
      </div>

      <div class="box" style="margin-top:14px">
        <div><strong>åˆ†å‰²çµæœ</strong></div>
        <div id="parts" class="parts" aria-live="polite"></div>
        <div id="calc-steps" class="calc-steps" aria-live="polite" style="display:none"></div>
        <div id="parts-msg" class="muted" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <script>
    const el = {
      input: document.getElementById('input'),
      reset: document.getElementById('reset'),
      parts: document.getElementById('parts'),
      calcSteps: document.getElementById('calc-steps'),
      partsMsg: document.getElementById('parts-msg'),
      internal: document.getElementById('internal'),
      effective: document.getElementById('effective'),
      error: document.getElementById('error')
    };

    // ä¸€æ™‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒãƒ¼
    let pasteErrorTimer = null;
    function showTempError(msg) {
      el.error.textContent = msg;
      if (pasteErrorTimer) clearTimeout(pasteErrorTimer);
      pasteErrorTimer = setTimeout(() => {
        // æ—¢ã«åˆ¥ã®ã‚¨ãƒ©ãƒ¼ã«å·®ã—æ›¿ã‚ã£ã¦ã„ãªã‘ã‚Œã°ã‚¯ãƒªã‚¢
        if (el.error.textContent === msg) el.error.textContent = '';
        pasteErrorTimer = null;
      }, 4000);
    }

    // è²¼ã‚Šä»˜ã‘æœ€é©åŒ–: ã‚«ãƒ³ãƒ/ç©ºç™½/%/ã€/ã€‚ã‚’é™¤å»ã—ã€ãã®å¾Œéæ•°å­—ã‚’é™¤å»ã—ã¦å³æ™‚å‡¦ç†ã€ã‚¨ãƒ©ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    el.input.addEventListener('paste', (ev) => {
      try {
        ev.preventDefault();
        const text = (ev.clipboardData || window.clipboardData).getData('text') || '';
        // ã¾ãšæƒ³å®šã•ã‚Œã‚‹åŒºåˆ‡ã‚Šæ–‡å­—ã‚„è¨˜å·ã‚’é™¤å»
        const sanitized = text.replace(/[,%\sã€ã€‚]/g, '');
        // æ¬¡ã«æ®‹ã‚‹éæ•°å­—ã‚’é™¤å»ã—ã¦æ•°å­—ã ã‘ã«ã™ã‚‹
        const digitsOnly = sanitized.replace(/\D+/g, '');
        if (!digitsOnly) {
          showTempError('è²¼ã‚Šä»˜ã‘ã«æ•°å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚');
          return;
        }
        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«æƒ³å®šã®è¨˜å·ãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆ
        if (sanitized !== text) {
          showTempError('è²¼ã‚Šä»˜ã‘æ™‚ã«ã‚«ãƒ³ãƒãƒ»ç©ºç™½ãƒ»%ãƒ»ã€ãƒ»ã€‚ã‚’è‡ªå‹•å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        } else if (digitsOnly !== sanitized) {
          // æƒ³å®šè¨˜å·ä»¥å¤–ã®éæ•°å­—ãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆã®è£œè¶³è¡¨ç¤º
          showTempError('è²¼ã‚Šä»˜ã‘æ™‚ã«éæ•°å­—ã‚’è‡ªå‹•å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        }
        el.input.value = digitsOnly; // ãƒ¡ã‚¤ãƒ³å…¥åŠ›ã«åæ˜ ï¼ˆæ¡æ•°ã¯æ¤œè¨¼ã§é€šçŸ¥ï¼‰
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç¶­æŒã—ã¦å‡¦ç†å®Ÿè¡Œ
        setTimeout(() => { onInput(); el.input.focus(); }, 0);
      } catch (e) {
        // å¤±æ•—ã—ãŸã‚‰æ—¢å­˜ã®å‹•ä½œã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      }
    });

    function clearDisplay() {
      el.parts.innerHTML = '';
      el.partsMsg.textContent = '';
      el.internal.textContent = 'â€”';
      el.effective.textContent = 'â€”';
      el.error.textContent = '';
    }

    function setError(msg) {
      el.error.textContent = msg;
      el.internal.textContent = 'â€”';
      el.effective.textContent = 'â€”';
    }

    // currentParts ã¯ UI ä¸Šã®åˆ†å‰²ã®ç¾åœ¨ã®å€¤ï¼ˆæ•°å€¤ã‹ nullï¼‰
    let currentParts = [null, null, null, null, null];

    function updateResultsFromParts(parts) {
      // parts: é…åˆ—ï¼ˆé•·ã•5ï¼‰ã§å„è¦ç´ ã¯æ•°å€¤ã¾ãŸã¯ null
      if (!parts || parts.length !== 5) {
        el.internal.textContent = 'â€”';
        el.effective.textContent = 'â€”';
        return;
      }
      // å…¨éƒ¨ãŒæœ‰åŠ¹ãªæ•°å€¤ã‹åˆ¤å®š
      for (let v of parts) {
        if (typeof v !== 'number' || !Number.isFinite(v) || v < 10 || v > 160) {
          // ç·¨é›†é€”ä¸­ã‚„ç„¡åŠ¹å€¤ãŒã‚ã‚‹å ´åˆã¯çµæœã‚’ã‚¯ãƒªã‚¢
          el.internal.textContent = 'â€”';
          el.effective.textContent = 'â€”';
          return;
        }
      }
      const internal = parts.reduce((a, b) => a + b, 0);
      const first = parts[0];
      const restSum = parts.slice(1).reduce((a, b) => a + b, 0);
      const effective = first + (restSum / 5);
      el.internal.textContent = String(internal);
      el.effective.textContent = String(Math.trunc(effective));
      el.error.textContent = '';
      // é€”ä¸­å¼ã‚’è¡¨ç¤º
      renderCalcSteps(parts, { internal, effective, restSum });
    }

    function renderParts(arr) {
      el.parts.innerHTML = '';
      const labels = ['ãƒªãƒ¼ãƒ€ãƒ¼','ã‚µãƒ–1','ã‚µãƒ–2','ã‚µãƒ–3','ã‚µãƒ–4'];
      // ãƒ©ãƒ™ãƒ«è¡Œ
      const labelsRow = document.createElement('div');
      labelsRow.className = 'parts-labels';
      for (let i = 0; i < 5; i++) {
        const cell = document.createElement('div');
        cell.className = 'label-cell';
        cell.textContent = labels[i] || '';
        labelsRow.appendChild(cell);
      }
      // å€¤è¡Œï¼ˆç·¨é›†å¯èƒ½ãªãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼‰
      const valuesRow = document.createElement('div');
      valuesRow.className = 'parts-values';
      for (let i = 0; i < 5; i++) {
        const cell = document.createElement('div');
        cell.className = 'value-cell';
        const input = document.createElement('input');
        input.type = 'tel';
        input.inputMode = 'numeric';
        input.pattern = '[0-9]*';
        input.maxLength = 3;
        input.style.width = '100%';
        input.style.border = 'none';
        input.style.background = 'transparent';
        input.style.textAlign = 'center';
        input.style.fontWeight = '700';
        input.style.padding = '0';
        input.style.margin = '0';
        input.style.boxSizing = 'border-box';
        input.value = (typeof arr[i] !== 'undefined') ? String(arr[i]) : '';
        input.dataset.index = String(i);
        // åˆæœŸ currentParts ã‚’è¨­å®š
        const parsed = input.value === '' ? null : Number(input.value);
        currentParts[i] = (parsed === null || Number.isNaN(parsed)) ? null : parsed;

        input.addEventListener('input', (ev) => {
          const idx = Number(ev.target.dataset.index);
          const v = ev.target.value.trim();
          if (v === '') {
            currentParts[idx] = null;
          } else if (/^\d+$/.test(v)) {
            const n = Number(v);
            if (Number.isFinite(n)) currentParts[idx] = n; else currentParts[idx] = null;
          } else {
            currentParts[idx] = null;
          }
          // ç·¨é›†æ™‚ã¯çµæœã‚’æ›´æ–°
          updateResultsFromParts(currentParts);
          // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: å…¨éƒ¨ãŒæœ‰åŠ¹ãªã‚‰ãƒ¡ã‚¤ãƒ³å…¥åŠ›ã‚’æ›´æ–°ã—ã¦åŒæœŸã™ã‚‹
          const allValid = currentParts.every(x => typeof x === 'number' && Number.isFinite(x));
          if (allValid) {
            // é€£çµã—ã¦ãƒ¡ã‚¤ãƒ³å…¥åŠ›ã«åæ˜ ï¼ˆã‚¼ãƒ­åŸ‹ã‚ãªã—ï¼‰
            el.input.value = currentParts.map(x => String(x)).join('');
          }
        });

        cell.appendChild(input);
        valuesRow.appendChild(cell);
      }
      el.parts.appendChild(labelsRow);
      el.parts.appendChild(valuesRow);

      // åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«çµæœåæ˜ 
      updateResultsFromParts(currentParts);
    }

    // åˆ†å‰²çµæœã®ä¸‹ã«é€”ä¸­å¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderCalcSteps(parts, computed) {
      if (!parts || parts.length !== 5) {
        el.calcSteps.style.display = 'none';
        el.calcSteps.innerHTML = '';
        return;
      }
      // parts ãŒæœ‰åŠ¹ãªæ•°åˆ—ã‹ã‚’ãƒã‚§ãƒƒã‚¯
      const allValid = parts.every(x => typeof x === 'number' && Number.isFinite(x) && x >= 10 && x <= 160);
      if (!allValid || !computed) {
        el.calcSteps.style.display = 'none';
        el.calcSteps.innerHTML = '';
        return;
      }
      const [a,b,c,d,e] = parts;
      const internal = computed.internal;
      const restSum = computed.restSum;
      const effectiveFull = computed.effective; // may be fractional

      const internalExpr = `å†…éƒ¨å€¤ = ${a} + ${b} + ${c} + ${d} + ${e} = ${internal}`;
      const effectiveExpr = `å®ŸåŠ¹å€¤ = ${a} + (${restSum}) / 5 = ${effectiveFull.toFixed(2)} â†’ ${Math.trunc(effectiveFull)}`;

      el.calcSteps.style.display = 'block';
      el.calcSteps.innerHTML = `
        <div class="line"><span class="label-small">${effectiveExpr}</span></div>
        <div class="line"><span class="label-small">${internalExpr}</span></div>
      `;
    }

    // 3æ¡å„ªå…ˆã®åˆ†å‰²ï¼ˆå„ãƒ–ãƒ­ãƒƒã‚¯ã¯ 2 or 3 æ¡ï¼‰
    function findPartition(s) {
      const n = s.length;
      if (n < 10 || n > 15) return null;
      const result = [];
      const lengths = [3, 2]; // å„ªå…ˆé †: 3æ¡ -> 2æ¡

      function backtrack(pos, k) {
        if (k === 0) return pos === n;
        const rem = n - pos;
        // prune: remaining chars must fit into k blocks of [2..3]
        if (rem < k*2 || rem > k*3) return false;
        for (const len of lengths) {
          if (pos + len > n) continue;
          const part = s.slice(pos, pos + len);
          if (part.length === 0) continue;
          if (part[0] === '0') continue; // å…ˆé ­ã‚¼ãƒ­ã¯ç„¡åŠ¹
          const val = Number(part);
          if (!Number.isFinite(val)) continue;
          if (val < 10 || val > 160) continue;
          result.push(val);
          if (backtrack(pos + len, k - 1)) return true;
          result.pop();
        }
        return false;
      }

      if (backtrack(0, 5)) return result.slice();
      return null;
    }

    function computeInternal(nums) {
      return nums.reduce((a, b) => a + b, 0);
    }

    function computeEffective(nums) {
      const first = nums[0];
      const restSum = nums.slice(1).reduce((a, b) => a + b, 0);
      return first + (restSum / 5);
    }

    function onInput() {
      const raw = el.input.value.trim();
      el.error.textContent = '';
      el.partsMsg.textContent = '';
      el.parts.innerHTML = '';

      if (raw.length === 0) { clearDisplay(); return; }
      if (/\D/.test(raw)) { setError('å…¥åŠ›ã¯æ•°å­—ã®ã¿ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆ0-9ï¼‰ã€‚'); return; }
      if (raw.length < 10) { clearDisplay(); el.partsMsg.textContent = 'å…¥åŠ›ã‚’ç¶šã‘ã¦ãã ã•ã„ï¼ˆæœ€ä½10æ¡ï¼‰ã€‚'; return; }
      if (raw.length > 15) { setError('å…¥åŠ›ã¯æœ€å¤§15æ¡ã¾ã§ã§ã™ã€‚'); return; }

      const parts = findPartition(raw);
      if (!parts) { setError('æœ‰åŠ¹ãªåˆ†å‰²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ¡æ•°ã‚„å„å€¤ã®ç¯„å›²(10ã€œ160)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'); return; }

      renderParts(parts);
      el.partsMsg.textContent = 'åˆ†å‰²æˆåŠŸ';
      const internal = computeInternal(parts);
      const effective = computeEffective(parts);
      el.internal.textContent = String(internal);
      // å®ŸåŠ¹å€¤ã¯æ•´æ•°éƒ¨åˆ†ã®ã¿è¡¨ç¤º
      el.effective.textContent = String(Math.trunc(effective));
    }

    el.input.addEventListener('input', onInput);
    el.reset.addEventListener('click', () => {
      el.input.value = '';
      el.input.focus();
      clearDisplay();
    });
    // åˆæœŸè¡¨ç¤º: ç”»é¢è¡¨ç¤ºæ™‚ã«ãƒ¡ã‚¤ãƒ³å…¥åŠ›ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»ã™
    clearDisplay();
    try { setTimeout(() => { el.input.focus(); }, 0); } catch (e) {}

    
  </script>
</body>
</html>
